# 深入理解数据库事务

事务是数据库区别于文件系统的核心特性，确保了数据的一致性和完整性。

## 1. ACID 特性

- **Atomicity (原子性)**: 事务是最小的执行单位，要么全部成功，要么全部失败回滚。
- **Consistency (一致性)**: 执行前后数据库的逻辑状态一致。
- **Isolation (隔离性)**: 并发执行的事务之间互不干扰。
- **Durability (持久性)**: 事务一旦提交，其结果就是永久性的。

## 2. 并发问题与隔离级别

| 隔离级别         |  脏读  | 不可重复读 |  幻读  |
| :--------------- | :----: | :--------: | :----: |
| Read Uncommitted |  可能  |    可能    |  可能  |
| Read Committed   | 不可能 |    可能    |  可能  |
| Repeatable Read  | 不可能 |   不可能   |  可能  |
| Serializable     | 不可能 |  不不可能  | 不可能 |

> [!NOTE]
> MySQL 默认隔离级别是 **Repeatable Read**，通过 MVCC 和 Next-Key Lock 极大程度规避了幻读。

## 3. 分布式事务

在微服务架构中，一个业务逻辑可能跨越多个数据库。

- **2PC (两阶段提交)**: 强一致性，但性能较差，存在单点故障风险。
- **TCC (Try-Confirm-Cancel)**: 业务侵入性强，柔性事务。
- **Saga**: 最终一致性，通过补偿机制解决失败情况。
- **基于消息的最大努力通知**: 适用于对实时性要求不高的场景。
